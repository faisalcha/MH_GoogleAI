CREATE TABLE IF NOT EXISTS payment_intents ( id bigserial PRIMARY KEY, job_id uuid NOT NULL, amount int NOT NULL, method varchar(16) NOT NULL, status varchar(16) NOT NULL, reference varchar(64) UNIQUE NOT NULL, captured_at timestamptz, created_at timestamptz NOT NULL DEFAULT now()); CREATE TABLE IF NOT EXISTS ledger_entries ( id bigserial PRIMARY KEY, intent_id bigint REFERENCES payment_intents(id), account varchar(32) NOT NULL, debit int NOT NULL DEFAULT 0, credit int NOT NULL DEFAULT 0, meta jsonb, created_at timestamptz NOT NULL DEFAULT now()); CREATE TABLE IF NOT EXISTS refund_requests ( id bigserial PRIMARY KEY, intent_id bigint REFERENCES payment_intents(id), amount int NOT NULL, reason text, opened_by varchar(64), status varchar(16) NOT NULL, reviewed_by varchar(64), reviewed_at timestamptz, created_at timestamptz NOT NULL DEFAULT now());