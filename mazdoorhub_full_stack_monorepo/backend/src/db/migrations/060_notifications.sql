CREATE TABLE IF NOT EXISTS notification_templates ( key varchar(64) PRIMARY KEY, channel varchar(16) NOT NULL, lang varchar(5) NOT NULL, name varchar(64) NOT NULL, body jsonb NOT NULL, updated_at timestamptz NOT NULL DEFAULT now() ); CREATE TABLE IF NOT EXISTS notification_outbox ( id bigserial PRIMARY KEY, channel varchar(16) NOT NULL, template_key varchar(64) NOT NULL, lang varchar(5) NOT NULL DEFAULT 'ur', to_id uuid, to_phone varchar(32), params jsonb NOT NULL DEFAULT '{}', status varchar(16) NOT NULL DEFAULT 'PENDING', attempts int NOT NULL DEFAULT 0, last_error text, created_at timestamptz NOT NULL DEFAULT now(), sent_at timestamptz ); CREATE INDEX IF NOT EXISTS idx_outbox_status_created ON notification_outbox(status, created_at); CREATE TABLE IF NOT EXISTS notification_logs ( id bigserial PRIMARY KEY, outbox_id bigint, channel varchar(16), provider_message_id varchar(64), status varchar(16), error text, created_at timestamptz NOT NULL DEFAULT now() );